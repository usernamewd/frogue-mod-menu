name: Build Frogue Mod

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-desktop:
    name: Build Desktop (LWJGL3)
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    - name: Build with Gradle
      run: ./gradlew lwjgl3:jar --no-daemon

    - name: Upload Desktop JAR
      uses: actions/upload-artifact@v4
      with:
        name: frogue-desktop-jar
        path: lwjgl3/build/libs/*.jar
        retention-days: 30

  build-html:
    name: Build HTML/Web (GWT)
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    - name: Build HTML distribution
      run: ./gradlew html:dist --no-daemon

    - name: Upload HTML Build
      uses: actions/upload-artifact@v4
      with:
        name: frogue-html-dist
        path: html/build/dist/
        retention-days: 30

  build-android:
    name: Build Android APK
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    - name: Grant execute permission for gradlew
      run: chmod +x gradlew

    - name: Build Android Debug APK
      run: ./gradlew android:assembleDebug --no-daemon

    - name: Upload Android APK
      uses: actions/upload-artifact@v4
      with:
        name: frogue-android-apk
        path: android/build/outputs/apk/debug/*.apk
        retention-days: 30

  create-release:
    name: Create Release
    needs: [build-desktop, build-html, build-android]
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'

    steps:
    - name: Download all artifacts
      uses: actions/download-artifact@v4

    - name: Get current date
      id: date
      run: echo "date=$(date +'%Y%m%d-%H%M%S')" >> $GITHUB_OUTPUT

    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: build-${{ steps.date.outputs.date }}
        name: Frogue Mod Build ${{ steps.date.outputs.date }}
        body: |
          ## Frogue Mod Menu Build

          This is an automated build of the Frogue mod with cheat menu.

          ### Features:
          - **ESP/Wallhack**: See enemies through walls
          - **Aimbot**: Auto-aim at enemies
          - **Silent Aimbot**: Hit enemies without camera movement
          - **God Mode**: Invincibility
          - **Visual Effects**: Rainbow World, Spiral Weapon, Matrix Mode, and more!
          - **Movement Cheats**: Super Speed, Super Jump, No Clip, Moon Gravity

          ### How to Use:
          - Press **INSERT** or **F12** to toggle the mod menu
          - Click the floating green button in-game

          ### Downloads:
          - **Desktop JAR**: Run with `java -jar frogue-desktop.jar`
          - **Android APK**: Install on Android device
          - **HTML**: Deploy to any web server

        files: |
          frogue-desktop-jar/*.jar
          frogue-android-apk/*.apk
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
